



<section class="flex w-full min-h-screen bg-gray-50 dark:bg-gray-900 ">
  <div [ngClass]="{
        'fixed inset-0 z-50 transform transition-transform duration-300': isMobile(),
        '-translate-x-full': isMobile() && !isSidebarOpen,

        'w-7': !isSidebarOpen && !isMobile(),
        'w-60': isSidebarOpen || isMobile()
      }" class="bg-white dark:bg-gray-800 shadow-lg transition-all duration-300 flex-shrink-0">
    <app-sidebar [collapsed]="!isSidebarOpen"></app-sidebar>
  </div>

  <div *ngIf="isSidebarOpen && isMobile()" class="fixed inset-0 bg-black/40 z-40" (click)="toggleSidebar()"></div>

  <main [ngClass]="{
      'ml-0 w-full': isMobile(),
      'ml-9 w-[calc(100%-2rem)]': !isSidebarOpen && !isMobile(),   
      'ml-5 w-[calc(100%-14rem)]': isSidebarOpen && !isMobile()   
    }" class="flex flex-col transition-all duration-300  overflow-auto">

    <app-admin-header [isDarkMode]="isDarkMode" (toggleSidebarEvent)="toggleSidebar()"
      (toggleDarkModeEvent)="toggleDarkMode()">
    </app-admin-header>

  <div class="pr-3 pl-3">
    <h1 class="text-3xl font-bold mb-4 dark:text-white">{{tr('Admin Reports')}}</h1>

    <!-- Error message -->
    <div *ngIf="errorMessage" class="p-3 bg-red-200 text-red-800 rounded">
      {{ errorMessage }}
    </div>

    <!-- All Reports Table -->
    <h2 class="text-xl font-semibold dark:text-white">{{tr('All Reports')}}</h2>

            
  <div class="overflow-x-auto bg-white dark:bg-gray-800 shadow rounded-lg mt-4">
    <table class="w-full text-left min-w-[400px] ">
      <thead class="bg-gray-100 dark:bg-gray-700">
        <tr>
          <th class="px-4 py-3 text-gray-900 dark:text-gray-100">{{tr('Reporter')}}</th>
          <th class="px-4 py-3 text-gray-900 dark:text-gray-100">{{tr('Reported User')}}</th>
          <th class="px-4 py-3 text-gray-900 dark:text-gray-100">{{tr('Type')}}</th>
          <!-- <th class="px-4 py-3 text-gray-900 dark:text-gray-100">{{tr('Reported User Status')}}</th> -->
          <th class="px-4 py-3 text-gray-900 dark:text-gray-100">{{tr('Description')}}</th>
          <th class="px-4 py-3 text-gray-900 dark:text-gray-100">{{tr('Report Status')}}</th>
          <th class="px-4 py-3 text-gray-900 dark:text-gray-100">{{tr('Created')}}</th>
          <th class="px-4 py-3 text-gray-900 dark:text-gray-100">{{tr('Actions')}}</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let r of allReports" class="hover:bg-gray-50">

          <!-- Reporter -->
          <td class="px-4 py-3 text-gray-900 dark:text-gray-100">
            <a class="text-blue-600 underline cursor-pointer"
               (click)="openUserProfile(r.reportedBy)">
              {{ r.reportedByName ? r.reportedByName : ('User:' + r.reportedBy) }}
            </a>
          </td>

          <!-- Target User -->
          <td class="px-4 py-3 text-gray-900 dark:text-gray-100">
            <ng-container *ngIf="r.reportedUserId; else noTarget">
              <a class="text-blue-600 underline cursor-pointer"
                 (click)="openUserProfile(r.reportedUserId)">
                {{ r.reportedUserName ? r.reportedUserName : ('User:' + r.reportedUserId) }}
              </a>

              <span *ngIf="r.reportedUserStatus === 'suspended'"
                    class="px-2 py-1 bg-red-200 text-red-700 rounded ml-1 text-xs">
                {{tr('Suspended')}}
              </span>
            </ng-container>

            <ng-template #noTarget>
              -
            </ng-template>
          </td>

          <!-- Entity Type -->
          <td class="px-4 py-3 text-gray-900 dark:text-gray-100">{{ r.entityType }}</td>

          <!-- Reported User Status -->
          <!-- <td class="px-4 py-3 text-gray-900 dark:text-gray-100">
            <span [ngClass]="r.reportedUserStatus === 'suspended' 
                              ? 'px-2 py-1 bg-red-200 text-red-700 rounded' 
                              : 'px-2 py-1 bg-green-200 text-green-700 rounded'">
              {{ r.reportedUserStatus === 'suspended' ? 'Suspended' : 'Active' }}
            </span>
          </td> -->

          <!-- Description -->
          <td class="px-4 py-3 text-gray-900 dark:text-gray-100">{{ r.description }}</td>

          <!-- Report Status -->
          <td class="px-4 py-3 text-gray-900 dark:text-gray-100">
            <span [ngClass]="getStatusBadge(r.status).class">
              {{ getStatusBadge(r.status).text }}
            </span>
            <span *ngIf="r.notified"
                  class="ml-2 px-2 py-1 bg-blue-200 text-blue-700 rounded text-xs">
              {{tr('Notified')}}
            </span>
          </td>

          <!-- Created At -->
          <td class="px-4 py-3 text-gray-900 dark:text-gray-100">{{ r.createdAt | date:'short' }}</td>

          <!-- Actions -->
          <td class="border p-2 flex gap-2 flex-wrap">

            <button class="px-2 py-1 bg-blue-500 text-white rounded"
                    (click)="updateStatus(r.reportId, 'Approved')">
              {{tr('Approve')}}
            </button>

            <button class="px-2 py-1 bg-yellow-500 text-white rounded"
                    (click)="updateStatus(r.reportId, 'Rejected')">
              {{tr('Reject')}}
            </button>

            <button class="px-2 py-1 bg-red-500 text-white rounded"
                    (click)="deleteReport(r.reportId)">
              {{tr('Delete')}}
            </button>

            <button *ngIf="r.reportedUserId"
                    [ngClass]="r.reportedUserStatus === 'suspended'
? 'px-2 py-1 bg-green-600 text-white rounded'
                      : 'px-2 py-1 bg-purple-600 text-white rounded'"
                    (click)="suspendOrRestoreUser(r.reportedUserId)">
              {{ r.reportedUserStatus === 'suspended' ? 'Restore User' : 'Suspend User' }}
            </button>

          </td>

        </tr>
      </tbody>
    </table>
    </div>
  </div>

</main>
</section>