<div>
    <section class="flex w-full min-h-screen bg-gray-50 dark:bg-gray-900 ">
        <div [ngClass]="{
        'fixed inset-0 z-50 transform transition-transform duration-300': isMobile(),
        '-translate-x-full': isMobile() && !isSidebarOpen,

        'w-7': !isSidebarOpen && !isMobile(),
        'w-60': isSidebarOpen || isMobile()
      }" class="bg-white dark:bg-gray-800 shadow-lg transition-all duration-300 flex-shrink-0">
            <app-sidebar [collapsed]="!isSidebarOpen"></app-sidebar>
        </div>


        <div *ngIf="isSidebarOpen && isMobile()" class="fixed inset-0 bg-black/40 z-40" (click)="toggleSidebar()"></div>

        <main [ngClass]="{
      'ml-0 w-full': isMobile(),
      'ml-9 w-[calc(100%-2rem)]': !isSidebarOpen && !isMobile(),   
      'ml-5 w-[calc(100%-14rem)]': isSidebarOpen && !isMobile()   
    }" class="flex flex-col transition-all duration-300  overflow-auto">

            <app-admin-header [isDarkMode]="isDarkMode" (toggleSidebarEvent)="toggleSidebar()"
                (toggleDarkModeEvent)="toggleDarkMode()">
            </app-admin-header>
            <div class="pr-3 pl-3 mt-5">

                <!-- Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">

                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow text-center">
                        <h2 class="text-lg font-semibold text-gray-800 dark:text-white mb-2">{{ tr('AVERAGE_DIAMONDS')
                            }}</h2>
                        <p class="text-3xl font-bold text-gray-900 dark:text-white">
                            {{ average?.averageDiamonds?.toFixed(2) ?? tr('LOADING') }}
                        </p>

                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow text-center">
                        <h2 class="text-lg font-semibold text-gray-800 dark:text-white mb-2">{{ tr('BUYERS_COUNT') }}
                        </h2>
                        <p class="text-3xl font-bold text-gray-900 dark:text-white">
                            {{ buyersCount?.buyersCount ?? tr('LOADING') }}
                        </p>
                    </div>

                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow text-center">
                        <h2 class="text-lg font-semibold text-gray-800 dark:text-white mb-2">{{ tr('TOTAL_USD') }}</h2>
                        <p class="text-3xl font-bold text-gray-900 dark:text-white">
                            ${{ totalUsd?.totalUsd?.toFixed(2) ?? tr('LOADING') }}
                        </p>
                    </div>

                </div>

                <!-- Users Table -->
                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow overflow-x-auto">
                    <table class="min-w-full table-auto text-gray-800 dark:text-white">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">{{ tr('USERNAME') }}</th>
                                <th class="px-4 py-2">{{ tr('CURRENT_DIAMONDS') }}</th>
                                <th class="px-4 py-2">{{ tr('PURCHASED_BEFORE') }}</th>
                                <th class="px-4 py-2">{{ tr('TOTAL_DIAMONDS_BOUGHT') }}</th>
                                <th class="px-4 py-2">{{ tr('TOTAL_USD') }}</th>
                                <th class="px-4 py-2">{{ tr('TRANSACTIONS') }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let user of usersDetails">
                                <td class="border px-4 py-2">{{ user.username }}</td>
                                <td class="border px-4 py-2">{{ user.currentDiamonds }}</td>
                                <td class="border px-4 py-2">{{ user.purchasedBefore ? tr('YES') : tr('NO') }}</td>
                                <td class="border px-4 py-2">{{ user.totalDiamondBought }}</td>
                                <td class="border px-4 py-2">${{ user.totalUsd }}</td>
                                <td class="border px-4 py-2">
                                    <ul class="list-disc ml-4">
                                        <li *ngFor="let t of user.diamondTransactions">
                                            {{ t.reason }}: +{{ t.pointsChanged }}
                                            <span *ngIf="t.priceUsd">(${{ t.priceUsd }})</span>
                                        </li>
                                    </ul>
                                </td>
                            </tr>
                            <tr *ngIf="usersDetails.length === 0">
                                <td class="text-center p-4" colspan="6">{{ tr('NO_USERS_FOUND') }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

            </div>

        </main>
    </section>
</div>