<div [ngClass]="{
        'fixed top-0 left-0 z-50 h-screen  transition-transform duration-300': true,
        '-translate-x-full': isMobile() && !isSidebarOpen,
        'translate-x-0': isSidebarOpen
      }" [style.width.px]="isSidebarOpen ? 240 : 56" class="bg-blue-700 dark:bg-gray-800 shadow-lg">
  <app-sidestudent [collapsed]="!isSidebarOpen"></app-sidestudent>
</div>

<div *ngIf="isSidebarOpen && isMobile()" class="fixed inset-0 bg-black/40 z-40" (click)="toggleSidebar()"></div>

<section class="setting">
  <main [ngStyle]="{'margin-left.px': isSidebarOpen && !isMobile() ? 240 : 56}"
  class="flex flex-col transition-all duration-300 overflow-auto min-h-screen bg-blue-800 dark:bg-gray-800">
  <app-user-header [isDarkMode]="isDarkMode" (toggleSidebarEvent)="toggleSidebar()"
    (toggleDarkModeEvent)="toggleDarkMode()" ></app-user-header>
  <div *ngIf="loading" class="loading">{{tr('Loading...')}}</div>

  <div *ngIf="!loading && profile" class="profile-container p-6 animate-in fade-in duration-500 dark:bg-gray-900">

    <div class="">


      <div class="rounded-lg border card bg-card text-card-foreground shadow-sm">
        <div class="flex flex-col space-y-1.5 p-6">
          <h3 class="text-2xl font-semibold leading-none tracking-tight">{{tr('Edit Profile')}}</h3>
        </div>

        <div class="p-6 pt-0">
          <div class="space-y-4">

            <form (ngSubmit)="saveChanges()">
              <!-- Name Fields -->
              <div class="grid grid-cols-2 gap-4">
                <div class="space-y-2">
                  <label for="fname" class="text-xl font-medium">
                    {{tr('First Name')}}
                  </label>
                  <input id="fname" [(ngModel)]="updateData.fname" name="fname" type="text" required class="flex h-10 w-full rounded-md border-3 border-blue-950 bg-background px-3 py-2 text-base
               placeholder:text-muted-foreground focus:outline-none focus:border-blue-950 focus:ring-1 focus:ring-blue-950
               disabled:cursor-not-allowed disabled:opacity-50 md:text-sm" />
                </div>

                <div class="space-y-2">
                  <label for="lname" class="text-xl font-medium">
                    {{tr('Last Name')}}
                  </label>
                  <input id="lname" [(ngModel)]="updateData.lname" name="lname" type="text" required class="flex h-10 w-full r3unded-md border- bg-background px-3 py-2 text-base
               placeholder:text-muted-foreground focus:outline-none focus:border-blue-950 focus:ring-1 focus:ring-blue-950
               disabled:cursor-not-allowed disabled:opacity-50 md:text-sm" />
                </div>
              </div>

              <!-- Profile Picture -->
              <!-- <div class="space-y-2 mt-4">
                <label for="profilePic" class="text-xl font-medium">
                  Profile Picture
                </label>
                <input id="profilePic" type="file" (change)="onFileSelected($event)"
                  class="flex h-10 w-full r3unded-md border- bg-background px-3 py-2 text-base
             focus:outline-none focus:border-blue-950 focus:ring-1 focus:ring-blue-950 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm" />
              </div> -->

              <!-- Bio -->
              <div class="space-y-2 mt-4">
                <label for="experienceText" class="text-xl font-medium">
                  {{tr('Bio')}}
                </label>
                <textarea id="experienceText" [(ngModel)]="updateData.experienceText" name="experienceText" rows="3"
                  class="flex min-h-[80px] w-full r3unded-md border- bg-background px-3 py-2 text-sm
             placeholder:text-muted-foreground focus:outline-none focus:border-blue-950 focus:ring-1 focus:ring-blue-950
             disabled:cursor-not-allowed disabled:opacity-50"></textarea>
              </div>

              <!-- Save Button -->
              <div class="flex justify-end mt-4">
                <button type="submit"
                  class="px-4 py-2 rounded-md  bg-blue-950 text-white hover:bg-blue-800 transition-colors">
                  {{tr('Save Changes')}}
                </button>
              </div>
            </form>


<div class="rounded-lg border card bg-card text-card-foreground shadow-sm p-6 space-y-4">

  <!-- Header + Add/Edit Button -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
    <h3 class=" font-semibold flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M18 2h-12a2 2 0 0 0-2 2v16l7-3 7 3V4a2 2 0 0 0-2-2z"></path>
      </svg>
      {{tr('Social Media')}}
    </h3>

    <!-- زر Add/Edit ديناميكي -->
    <button type="button" class="py-2 px-3 rounded-xl bg-blue-950 text-white"
            *ngIf="!showAddSocialMedia"
            (click)="socialMedia ? editExistingSocialMedia() : showAddSocialMediaForm()">
    {{ socialMedia ? tr('Edit Social Media') : tr('+ Add Social Media') }}

    </button>
  </div>

  <!-- الفورم لإضافة/تعديل السوشيال ميديا -->
  <div *ngIf="showAddSocialMedia" class="flex flex-col gap-3 bg-card p-4 rounded-lg shadow-inner mb-4">
    <form (ngSubmit)="saveSocialMedia()">
      <div class="space-y-2">
        <label class="text-xl font-medium">{{tr('LinkedIn')}}</label>
        <input [(ngModel)]="socialMediaData.linkedin" name="linkedin" type="url" placeholder="https://linkedin.com/in/username"
               class="input input-bordered w-full" />
      </div>
      <div class="space-y-2">
        <label class="text-xl font-medium">{{tr('Facebook')}}</label>
        <input [(ngModel)]="socialMediaData.facebookLink" name="facebookLink" type="url" placeholder="https://facebook.com/username"
               class="input input-bordered w-full" />
      </div>
      <div class="space-y-2">
        <label class="text-xl font-medium">{{tr('Website')}}</label>
        <input [(ngModel)]="socialMediaData.personalWebsite" name="personalWebsite" type="url" placeholder="https://yourwebsite.com"
               class="input input-bordered w-full" />
      </div>
      <div class="flex justify-end gap-2 mt-4">
        <button type="submit" class="btn btn-primary">{{tr('Save')}}</button>
        <button type="button" class="btn btn-outline" (click)="cancelSocialMediaEdit()">{{tr('Cancel')}}</button>
      </div>
    </form>
  </div>

  <div class="mt-4">
    <ng-container *ngIf="socialMedia; else noSocialMedia">
      <p *ngIf="socialMedia.linkedin" class="flex items-center">
          <span class="text-xl font-medium">{{tr('LinkedIn')}}</span>
        <a [href]="socialMedia.linkedin" target="_blank" class="text-blue-600">{{ socialMedia.linkedin }}</a>
      </p>
      <p *ngIf="socialMedia.facebookLink" class="flex items-center gap-2">
         <span class="text-xl font-medium">{{tr('Facebook')}}</span>
        <a [href]="socialMedia.facebookLink" target="_blank" class="text-blue-700">{{ socialMedia.facebookLink }}</a>
      </p>
      <p *ngIf="socialMedia.personalWebsite" class="flex items-center gap-2">
        <span class="text-xl font-medium">{{tr('Website')}}</span>
        <a [href]="socialMedia.personalWebsite" target="_blank" class="text-green-600">{{ socialMedia.personalWebsite }}</a>
      </p>
    </ng-container>
    <ng-template #noSocialMedia>
      <p class="text-gray-400">{{tr('No social media links yet.')}}</p>
    </ng-template>
  </div>

</div>



          </div>
        </div>
      </div>




<div class="flex flex-col md:flex-row gap-4 items-stretch mt-3 mb-3">
  <div class="p-6 card bg-card text-card-foreground shadow-lg rounded-xl w-full md:w-1/2 flex flex-col">
    <form (ngSubmit)="addSelectedSkill()" class="flex flex-col flex-1">
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
        <h3 class="text-2xl font-semibold flex items-center gap-2">{{tr('Skills')}}</h3>
        <button type="button" class="py-2 px-3 rounded-xl bg-blue-950 text-white" (click)="showAddSkill = !showAddSkill">
          {{tr('+ Add New Skills')}}
        </button>
      </div>
      <div *ngIf="showAddSkill" class="flex flex-col gap-3 bg-card p-4 rounded-lg shadow-inner mb-4">
          
        <select [(ngModel)]="selectedCategoryId" name="category" class="input input-bordered w-full" (change)="onCategoryChange($event)">
          <option value=""  disabled selected >{{tr('Select Category')}}</option>
          <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
        </select>
        <select [(ngModel)]="selectedSkillId" name="skill" class="input input-bordered w-full" [disabled]="!selectedCategoryId">
          <option value="" disabled selected>{{tr('Select Skill')}}</option>
          <option *ngFor="let s of categorySkills" [value]="s.id">{{ s.name }}</option>
        </select>
        <input type="number" [(ngModel)]="newSkillGoodAt" name="level" min="1" max="5" class="input input-bordered w-full" placeholder="Level 1-5">
        <button type="submit" class="btn btn-primary mt-2">{{tr('Save')}}</button>
        <button type="button" class="btn btn-outline mt-2" (click)="showAddSkill=false">{{tr('Cancel')}}</button>
      </div>
      <div class="space-y-4 flex-1 overflow-auto">
        <div *ngFor="let skill of skills" class="flex items-center justify-between p-3 bg-card rounded-lg shadow-sm">
          <span class="font-medium">{{ skill.name }}</span>
          <div class="flex items-center gap-2">
            <ng-container *ngFor="let i of [1,2,3,4,5]">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="h-5 w-5" [ngClass]="i <= (skill?.goodAtIt ?? 0) ? 'text-yellow-500' : 'text-gray-300'" fill="currentColor">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.95a1 1 0 0 0 .95.69h4.148c.969 0 1.371 1.24.588 1.81l-3.36 2.44a1 1 0 0 0-.364 1.118l1.286 3.95c.3.921-.755 1.688-1.54 1.118l-3.36-2.44a1 1 0 0 0-1.176 0l-3.36 2.44c-.784.57-1.838-.197-1.539-1.118l1.286-3.95a1 1 0 0 0-.364-1.118L2.077 9.378c-.784-.57-.38-1.81.588-1.81h4.148a1 1 0 0 0 .95-.69l1.286-3.95z" />
              </svg>
            </ng-container>
            <button *ngIf="!skill.editing" class="btn btn-danger btn-sm" (click)="deleteSkill(skill)">{{tr('Delete')}}</button>
            <div *ngIf="skill.editing" class="flex gap-2">
              <input type="number" [(ngModel)]="skill.goodAtIt" min="1" max="5" class="input input-bordered w-16">
              <button type="button" class="btn btn-success btn-sm" (click)="saveSkill(skill)">{{tr('Save')}}</button>
              <button type="button" class="btn btn-outline btn-sm" (click)="skill.editing=false">{{tr('Cancel')}}</button>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>

  <div class="p-6 card bg-card text-card-foreground shadow-lg rounded-xl w-full md:w-1/2 flex flex-col">
    <div class="flex flex-col flex-1">
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
        <h3 class="text-2xl font-semibold flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526"></path>
            <circle cx="12" cy="8" r="6"></circle>
          </svg>
          {{tr('Certificates')}}
        </h3>
        <button class="py-2 px-3 rounded-xl bg-blue-950 text-white" (click)="showAddCertificate = !showAddCertificate">
          {{tr('+ Add New Certificate')}}
        </button>
      </div>
      <div class="space-y-4 flex-1 overflow-auto">
        <div *ngIf="showAddCertificate" class="p-3 border rounded-lg flex flex-col gap-2 mb-4">
          <input type="text" placeholder="Certificate Name" [(ngModel)]="newCertificate.cername" name="cername" class="input input-bordered w-full" />
          <input type="text" placeholder="Institution" [(ngModel)]="newCertificate.instatutionName" name="instatutionName" class="input input-bordered w-full" />
          <input type="number" placeholder="Year" [(ngModel)]="newCertificate.earnedYear" name="earnedYear" min="1900" max="2025" class="input input-bordered w-full" />
          <input type="file" (change)="onCertificateFileSelected($event)" />
          <div class="flex gap-2">
            <button class="btn btn-success btn-sm" (click)="addCertificate()">{{tr('Add')}}</button>
            <button class="btn btn-outline btn-sm" (click)="showAddCertificate = false">{{tr('Cancel')}}</button>
          </div>
        </div>
        <div *ngFor="let cer of certificates" class="p-3 border rounded-lg flex justify-between items-center">
          <div class="flex justify-between items-center w-full">
            <div>
              <p *ngIf="!cer.editing" class="font-semibold ml-3">{{ cer.cername }}</p>
              <p *ngIf="!cer.editing" class="text-xl text-gray-400">{{ cer.instatutionName }} {{ cer.earnedYear }}</p>
            </div>
            <div *ngIf="cer.editing" class="flex flex-col gap-2">
              <img [src]="cer.cerpic || 'placeholder.png'" alt="Certificate" width="100" class="mb-2">
              <input type="text" [(ngModel)]="cer.cername" placeholder="Certificate Name" class="input input-bordered w-full">
              <input type="text" [(ngModel)]="cer.instatutionName" placeholder="Institution" class="input input-bordered w-full">
              <input type="number" [(ngModel)]="cer.earnedYear" placeholder="Year" min="1900" max="2025" step="1" class="input input-bordered w-full">
              <input type="file" (change)="onCertificateFileSelected($event, cer)">
              <div class="flex gap-2 mt-2">
                <button class="btn btn-success btn-sm" (click)="saveCertificate(cer)">{{tr('Save')}}</button>
                <button class="btn btn-outline btn-sm" (click)="cancelEdit(cer)">{{tr('Cancel')}}</button>
              </div>
            </div>
            <div *ngIf="!cer.editing" class="flex items-center gap-2 mt-2">
              <button class="btn btn-danger btn-sm" (click)="deleteCertificate(cer)">{{tr('Delete')}}</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>








      <!-- PROJECTS -->
      <div class="rounded-lg border card bg-card text-card-foreground shadow-sm p-6 space-y-4">

        <div class="flex justify-between items-center">
          <h3 class="text-2xl font-semibold flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
              <rect width="20" height="14" x="2" y="6" rx="2"></rect>
            </svg>
            {{tr('Projects')}}
          </h3>
          <button class="py-2 px-3 rounded-xl bg-blue-950 text-white" (click)="showAddProject = !showAddProject">{{tr('+ Add
            Project')}}</button>
        </div>

        <div *ngIf="showAddProject" class="flex flex-col gap-3 bg-card p-4 rounded-lg shadow-inner">
          <input type="text" [(ngModel)]="newProject.projectName" placeholder="Project Name"
            class="input input-bordered w-full">
          <textarea [(ngModel)]="newProject.projectDesc" placeholder="Project Description"
            class="input input-bordered w-full"></textarea>
          <input type="text" [(ngModel)]="newProject.repolink" placeholder="Repo Link"
            class="input input-bordered w-full">
          <button class="btn btn-primary mt-2" (click)="addProject()">{{tr('Add Project')}}</button>
        </div>

        <div *ngIf="projects.length > 0; else noProjects" class="grid gap-4 md:grid-cols-2">
          <div *ngFor="let proj of projects"
            class="p-4 border rounded-lg space-y-2 hover:shadow-md transition-shadow flex justify-between">
            <div>
              <h4 class="font-semibold">{{ proj.projectName }}</h4>
              <p class="text-xl text-muted-foreground">{{ proj.projectDesc }}</p>
            </div>
            <div> <a [href]="proj.repolink" target="_blank" rel="noopener noreferrer" class="btn btn-sm">
               
              </a>
              <button class="btn btn-sm" (click)="deleteProject(proj.projectId)">{{tr('Delete')}}</button>
            </div>
          </div>
        </div>

        <ng-template #noProjects>
          <p class="text-gray-400">{{tr('No projects yet.')}}</p>
        </ng-template>

      </div>




    </div>

  </div>

</main>
</section>